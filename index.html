<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NetWeb 本地项目管理</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="app">
      <header class="top-bar">
        <button class="brand brand-button" id="home-button" type="button" aria-label="返回主界面">
          <div class="brand-icon">NW</div>
          <div>
            <h1>NetWeb</h1>
            <p>数据网项目交付管理</p>
          </div>
        </button>
        <nav class="nav">
          <div class="nav-group">
            <button class="tab active" data-menu="project-menu">项目管理</button>
            <div class="nav-panel" id="project-menu">
              <button class="nav-item" data-action="new-project">新建项目</button>
              <div class="nav-item-group">
                <button class="nav-item" data-action="project-in-progress">正在进行</button>
                <div class="nav-submenu" data-submenu="in-progress"></div>
              </div>
              <div class="nav-item-group">
                <button class="nav-item" data-action="project-completed">已完成</button>
                <div class="nav-submenu" data-submenu="completed"></div>
              </div>
            </div>
          </div>
          <div class="nav-group">
            <button class="tab" data-menu="system-menu">系统管理</button>
            <div class="nav-panel" id="system-menu">
              <button class="nav-item" data-action="system-basic">基本设置</button>
              <button class="nav-item">安全管理</button>
              <button class="nav-item" data-action="system-logs">操作日志</button>
            </div>
          </div>
        </nav>
        <div class="actions">
          <div class="action-row">
            <button class="icon-button" id="version-button" aria-label="版本信息">
              <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
                <path
                  d="M12 3.4c-4.8 0-8.6 3.8-8.6 8.6s3.8 8.6 8.6 8.6 8.6-3.8 8.6-8.6-3.8-8.6-8.6-8.6Zm0 4.2c.6 0 1 .5.9 1.1l-.6 5.2a.4.4 0 0 1-.8 0l-.6-5.2c-.1-.6.3-1.1.9-1.1Zm0 9.7a1.2 1.2 0 1 1 0-2.4 1.2 1.2 0 0 1 0 2.4Z"
                />
              </svg>
            </button>
            <div class="user-profile">
              <button class="icon-button user-icon-button" aria-label="用户">
                <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
                  <path
                    d="M12 12.5c2.4 0 4.4-2 4.4-4.4S14.4 3.7 12 3.7 7.6 5.7 7.6 8.1 9.6 12.5 12 12.5Zm0 2.1c-4 0-7.4 2.1-7.4 4.6 0 .7.6 1.1 1.3 1.1h12.2c.7 0 1.3-.4 1.3-1.1 0-2.5-3.4-4.6-7.4-4.6Z"
                  />
                </svg>
              </button>
              <span class="user-name">Admin</span>
            </div>
            <button class="icon-button" id="mode-toggle" aria-label="明暗切换">
              <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
                <path
                  d="M12 3.4a8.6 8.6 0 1 1-6.1 2.5 8.6 8.6 0 0 1 6.1-2.5Zm0 2a6.6 6.6 0 1 0 0 13.2V5.4Z"
                />
              </svg>
            </button>
            <button class="icon-button" id="theme-toggle" aria-label="主题切换">
              <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
                <path
                  d="M5.4 6.1A1.7 1.7 0 0 1 7.1 4.4h9.8a1.7 1.7 0 0 1 1.7 1.7v9.8a1.7 1.7 0 0 1-1.7 1.7H7.1a1.7 1.7 0 0 1-1.7-1.7V6.1Zm1.9.6v8.6h9.3V6.7H7.3Zm2.1 6.9 2.4-3 1.9 2.2 1.4-1.6 1.8 2.4H9.4Z"
                />
              </svg>
            </button>
          </div>
        </div>
      </header>

      <main class="main-area">
        <section class="home-view" id="home-view">
          <div class="home-header">
            <h2>项目管理</h2>
          </div>
          <div class="home-cards">
            <button class="home-card home-card-create" data-action="new-project">新建项目</button>
            <div
              class="home-card home-card-progress"
              data-action="project-in-progress"
              role="group"
              aria-label="正在进行项目"
            >
              <div class="home-card-header">
                <div class="home-card-title">正在进行</div>
              </div>
              <div class="home-submenu" data-home-submenu="in-progress"></div>
            </div>
            <div
              class="home-card home-card-completed"
              data-action="project-completed"
              role="group"
              aria-label="已完成项目"
            >
              <div class="home-card-header">
                <div class="home-card-title">已完成</div>
              </div>
              <div class="home-submenu" data-home-submenu="completed"></div>
            </div>
          </div>
          <button class="task-button home-task-button" aria-label="任务日志">
            <span class="task-icon" aria-hidden="true">◎</span>
          </button>
        </section>

        <div class="layout">
          <aside class="sidebar">
            <div class="sidebar-header">
              <h2 id="sidebar-title">项目管理</h2>
            </div>
            <div class="menu" data-menu="project">
              <button class="menu-item active" data-panel="topology-panel">站点拓扑</button>
              <button class="menu-item" data-panel="script-panel">脚本管理</button>
              <button class="menu-item" data-panel="other-panel">其他</button>
            </div>
            <div class="menu is-hidden" data-menu="system-basic">
              <button class="menu-item active" data-panel="timeout-panel">超时时间</button>
              <button class="menu-item" data-panel="system-theme-panel">系统主题</button>
            </div>
            <div class="menu is-hidden" data-menu="system-log">
              <button class="menu-item active" data-panel="system-log-panel">操作日志</button>
            </div>
            <button class="task-button" aria-label="任务日志">
              <span class="task-icon" aria-hidden="true">◎</span>
            </button>
          </aside>

          <section class="content">
            <div class="panel active" id="topology-panel">
              <div class="content-header content-header-split">
                <button class="primary" id="site-upload-button">添加站点</button>
                <h2 class="content-title content-title-center">站点拓扑</h2>
                <button class="ghost" data-empty="true">导出拓扑</button>
              </div>
              <div class="canvas">
                <div class="canvas-header">
                  <h3>主内容区域</h3>
                  <span>在此呈现站点拓扑与可视化配置</span>
                </div>
                <div class="canvas-body">
                  <div class="placeholder">
                    <div class="placeholder-icon">◎</div>
                    <p>空白画布</p>
                    <span>拖拽设备与节点开始配置</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="panel" id="script-panel">
              <div class="empty-state">
                <div class="placeholder-icon">◎</div>
                <p>脚本管理视图</p>
                <span>选择左侧菜单以查看脚本内容</span>
              </div>
            </div>
            <div class="panel" id="timeout-panel">
              <div class="content-header">
                <h2 class="content-title">超时时间</h2>
              </div>
              <div class="settings-card">
                <label class="field">
                  <span>超时时间（分钟）</span>
                  <input type="number" value="999" min="1" />
                </label>
                <p class="helper-text">超时后将自动退出当前账号。</p>
              </div>
            </div>
            <div class="panel" id="system-theme-panel">
              <div class="content-header">
                <h2 class="content-title">系统主题</h2>
              </div>
              <div class="theme-settings">
                <section class="setting-section">
                  <div class="setting-title">明暗调节</div>
                  <div class="mode-switch" role="group" aria-label="明暗调节">
                    <button class="mode-chip" data-mode="light">明亮模式</button>
                    <button class="mode-chip" data-mode="dark">黑暗模式</button>
                  </div>
                </section>
                <section class="setting-section">
                  <div class="setting-title">主题调节</div>
                  <div class="theme-grid" id="theme-grid"></div>
                </section>
              </div>
            </div>
            <div class="panel" id="system-log-panel">
              <div class="content-header">
                <h2 class="content-title">操作日志</h2>
              </div>
              <div class="log-table" id="system-log-list" role="table" aria-label="系统操作日志">
                <div class="log-row log-header" role="row">
                  <span role="columnheader">操作内容</span>
                  <span role="columnheader">开始时间</span>
                  <span role="columnheader">进度</span>
                  <span role="columnheader">完成时间</span>
                  <span role="columnheader">结果</span>
                </div>
              </div>
            </div>
            <div class="panel" id="other-panel">
              <div class="content-header">
                <h2 class="content-title">其他</h2>
              </div>
              <div class="other-panel">
                <div class="other-panel-header">
                  <div>
                    <h3>项目完成标记</h3>
                    <p>选择项目执行已完成或取消已完成。</p>
                  </div>
                  <span class="other-hint">标记后将同步到项目管理子菜单</span>
                </div>
                <div class="project-status-list" id="project-status-list"></div>
              </div>
            </div>
          </section>
        </div>
      </main>
    </div>

    <div class="modal task-popover" id="task-modal" aria-hidden="true">
      <div class="modal-card task-card">
        <div class="modal-header">
          <h3>最近任务日志</h3>
          <button class="icon-button" data-close="task-modal" aria-label="关闭">
            <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
              <path
                d="M6.7 6.7a.8.8 0 0 1 1.1 0L12 11l4.2-4.3a.8.8 0 0 1 1.1 1.1L13.1 12l4.2 4.2a.8.8 0 0 1-1.1 1.1L12 13.1l-4.2 4.2a.8.8 0 0 1-1.1-1.1L10.9 12 6.7 7.8a.8.8 0 0 1 0-1.1Z"
              />
            </svg>
          </button>
        </div>
        <div class="task-table" id="task-log-list" role="table" aria-label="最近任务">
          <div class="task-row task-header" role="row">
            <span role="columnheader">任务名称</span>
            <span role="columnheader">开始时间</span>
            <span role="columnheader">进度</span>
            <span role="columnheader">完成时间</span>
            <span role="columnheader">结果</span>
          </div>
        </div>
      </div>
    </div>
    <div class="toast" id="empty-toast" aria-hidden="true">无</div>

    <div class="modal version-modal" id="version-modal" aria-hidden="true">
      <div class="modal-card">
        <div class="modal-header">
          <h3>版本信息</h3>
          <button class="icon-button" data-close="version-modal" aria-label="关闭">
            <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
              <path
                d="M6.7 6.7a.8.8 0 0 1 1.1 0L12 11l4.2-4.3a.8.8 0 0 1 1.1 1.1L13.1 12l4.2 4.2a.8.8 0 0 1-1.1 1.1L12 13.1l-4.2 4.2a.8.8 0 0 1-1.1-1.1L10.9 12 6.7 7.8a.8.8 0 0 1 0-1.1Z"
              />
            </svg>
          </button>
        </div>
        <p class="version-text">当前版本 0.1</p>
      </div>
    </div>

    <div class="modal" id="project-modal" aria-hidden="true">
      <div class="modal-card">
        <div class="modal-header">
          <h3>新建项目</h3>
          <button class="icon-button" data-close="project-modal" aria-label="关闭">
            <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
              <path
                d="M6.7 6.7a.8.8 0 0 1 1.1 0L12 11l4.2-4.3a.8.8 0 0 1 1.1 1.1L13.1 12l4.2 4.2a.8.8 0 0 1-1.1 1.1L12 13.1l-4.2 4.2a.8.8 0 0 1-1.1-1.1L10.9 12 6.7 7.8a.8.8 0 0 1 0-1.1Z"
              />
            </svg>
          </button>
        </div>
        <label class="field">
          <span>项目名称</span>
          <input type="text" id="project-input" placeholder="请输入项目名称" />
        </label>
        <button class="primary" id="project-submit">创建</button>
      </div>
    </div>

    <div class="modal" id="site-modal" aria-hidden="true">
      <div class="modal-card">
        <div class="modal-header">
          <h3>上传站点信息</h3>
          <button class="icon-button" data-close="site-modal" aria-label="关闭">
            <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
              <path
                d="M6.7 6.7a.8.8 0 0 1 1.1 0L12 11l4.2-4.3a.8.8 0 0 1 1.1 1.1L13.1 12l4.2 4.2a.8.8 0 0 1-1.1 1.1L12 13.1l-4.2 4.2a.8.8 0 0 1-1.1-1.1L10.9 12 6.7 7.8a.8.8 0 0 1 0-1.1Z"
              />
            </svg>
          </button>
        </div>
        <label class="field">
          <span>选择本地文件（仅支持 Excel）</span>
          <input
            type="file"
            id="site-file"
            accept=".xls,.xlsx,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
          />
        </label>
        <div class="template-download">
          <span>站点互联信息模板</span>
          <a href="站点互联信息模板.xlsx" download>下载模板</a>
        </div>
        <button class="primary" id="site-upload-submit" disabled>上传</button>
      </div>
    </div>

    <script>
      const navTabs = document.querySelectorAll('.tab');
      const navPanels = document.querySelectorAll('.nav-panel');
      const menuItems = document.querySelectorAll('.menu-item');
      const menuGroups = document.querySelectorAll('.menu');
      const panels = document.querySelectorAll('.panel');
      const taskButtons = document.querySelectorAll('.task-button');
      const taskModal = document.getElementById('task-modal');
      const emptyToast = document.getElementById('empty-toast');
      const versionButton = document.getElementById('version-button');
      const versionModal = document.getElementById('version-modal');
      const projectModal = document.getElementById('project-modal');
      const projectInput = document.getElementById('project-input');
      const projectSubmit = document.getElementById('project-submit');
      const sidebarTitle = document.getElementById('sidebar-title');
      const siteModal = document.getElementById('site-modal');
      const siteUploadButton = document.getElementById('site-upload-button');
      const siteFileInput = document.getElementById('site-file');
      const siteUploadSubmit = document.getElementById('site-upload-submit');
      const modeToggle = document.getElementById('mode-toggle');
      const themeToggle = document.getElementById('theme-toggle');
      const themeGrid = document.getElementById('theme-grid');
      const modeChips = document.querySelectorAll('.mode-chip');
      const homeButton = document.getElementById('home-button');
      const homeCards = document.querySelectorAll('.home-card');
      const taskLogList = document.getElementById('task-log-list');
      const systemLogList = document.getElementById('system-log-list');
      const projectStatusList = document.getElementById('project-status-list');
      const projectSubmenuInProgress = document.querySelector('[data-submenu="in-progress"]');
      const projectSubmenuCompleted = document.querySelector('[data-submenu="completed"]');
      const homeSubmenuInProgress = document.querySelector('[data-home-submenu="in-progress"]');
      const homeSubmenuCompleted = document.querySelector('[data-home-submenu="completed"]');
      let toastTimer;
      let navCloseTimer;
      const projects = [];
      const maxRecentTasks = 10;
      const taskLogs = [
        {
          name: '主干链路巡检',
          startTime: '18:55',
          endTime: '18:59',
          progress: 100,
          result: '失败',
          status: 'fail',
          logTime: '18:59',
        },
        {
          name: '站点配置推送',
          startTime: '16:20',
          endTime: '16:22',
          progress: 100,
          result: '完成',
          status: 'success',
          logTime: '16:22',
        },
        {
          name: '备份任务执行',
          startTime: '11:14',
          endTime: '11:21',
          progress: 100,
          result: '完成',
          status: 'success',
          logTime: '11:21',
        },
      ];
      let currentProject = null;

      const themeAssetBase = 'themes';

      const themePresets = [
        {
          name: '苹果磨砂',
          preview: `url("${themeAssetBase}/01_apple_frost.png")`,
          lightBackground: `url("${themeAssetBase}/01_apple_frost.png")`,
          darkBackground: `linear-gradient(180deg, rgba(8, 12, 20, 0.55) 0%, rgba(8, 12, 20, 0.75) 100%), url("${themeAssetBase}/01_apple_frost.png")`,
          accent: '#007aff',
          accentSoft: 'rgba(0, 122, 255, 0.14)',
          brand: 'linear-gradient(135deg, #5ac8fa, #007aff)',
          light: {
            surface: 'rgba(255, 255, 255, 0.74)',
            surfaceStrong: 'rgba(255, 255, 255, 0.92)',
            text: '#1d1d1f',
            muted: '#6e6e73',
            border: 'rgba(60, 60, 67, 0.16)',
            shadow: '0 24px 70px rgba(12, 18, 32, 0.14)',
            shadowSoft: '0 10px 30px rgba(25, 31, 44, 0.08)',
            glow: '0 0 0 1px rgba(255, 255, 255, 0.6) inset, 0 10px 30px rgba(0, 0, 0, 0.08)',
          },
          dark: {
            surface: 'rgba(20, 24, 34, 0.86)',
            surfaceStrong: 'rgba(25, 30, 44, 0.96)',
            text: '#f5f6f8',
            muted: '#b2b8c4',
            border: 'rgba(148, 163, 184, 0.24)',
            shadow: '0 24px 70px rgba(0, 0, 0, 0.55)',
            shadowSoft: '0 10px 30px rgba(0, 0, 0, 0.35)',
            glow: '0 0 0 1px rgba(255, 255, 255, 0.08) inset, 0 10px 30px rgba(0, 0, 0, 0.45)',
          },
        },
        {
          name: '苹果深色',
          preview: `url("${themeAssetBase}/02_apple_dark.png")`,
          lightBackground: `linear-gradient(180deg, rgba(255, 255, 255, 0.10) 0%, rgba(255, 255, 255, 0.02) 100%), url("${themeAssetBase}/02_apple_dark.png")`,
          darkBackground: `url("${themeAssetBase}/02_apple_dark.png")`,
          accent: '#0a84ff',
          accentSoft: 'rgba(10, 132, 255, 0.18)',
          brand: 'linear-gradient(135deg, #64d2ff, #0a84ff)',
          light: {
            surface: 'rgba(255, 255, 255, 0.72)',
            surfaceStrong: 'rgba(255, 255, 255, 0.9)',
            text: '#111827',
            muted: '#667085',
            border: 'rgba(60, 60, 67, 0.16)',
            shadow: '0 24px 70px rgba(12, 18, 32, 0.14)',
            shadowSoft: '0 10px 30px rgba(25, 31, 44, 0.08)',
            glow: '0 0 0 1px rgba(255, 255, 255, 0.6) inset, 0 10px 30px rgba(0, 0, 0, 0.08)',
          },
          dark: {
            surface: 'rgba(14, 18, 28, 0.78)',
            surfaceStrong: 'rgba(16, 21, 34, 0.92)',
            text: '#eaf0ff',
            muted: '#a7b2c6',
            border: 'rgba(148, 163, 184, 0.26)',
            shadow: '0 30px 70px rgba(0, 0, 0, 0.62)',
            shadowSoft: '0 16px 36px rgba(0, 0, 0, 0.48)',
            glow: '0 0 0 1px rgba(255, 255, 255, 0.10) inset, 0 10px 30px rgba(0, 0, 0, 0.55)',
          },
        },
        {
          name: '赛博朋克',
          preview: `url("${themeAssetBase}/03_cyberpunk.png")`,
          lightBackground: `linear-gradient(180deg, rgba(0, 0, 0, 0.12) 0%, rgba(0, 0, 0, 0.22) 100%), url("${themeAssetBase}/03_cyberpunk.png")`,
          darkBackground: `linear-gradient(180deg, rgba(0, 0, 0, 0.35) 0%, rgba(0, 0, 0, 0.65) 100%), url("${themeAssetBase}/03_cyberpunk.png")`,
          accent: '#38bdf8',
          accentSoft: 'rgba(56, 189, 248, 0.22)',
          brand: 'linear-gradient(135deg, #a855f7, #38bdf8)',
          light: {
            surface: 'rgba(255, 255, 255, 0.68)',
            surfaceStrong: 'rgba(255, 255, 255, 0.9)',
            text: '#0f172a',
            muted: '#5b678a',
            border: 'rgba(79, 70, 229, 0.22)',
            shadow: '0 26px 60px rgba(56, 68, 130, 0.26)',
            shadowSoft: '0 12px 30px rgba(56, 68, 130, 0.18)',
            glow: '0 0 0 1px rgba(99, 102, 241, 0.22) inset, 0 10px 30px rgba(99, 102, 241, 0.16)',
          },
          dark: {
            surface: 'rgba(10, 14, 27, 0.80)',
            surfaceStrong: 'rgba(16, 21, 38, 0.92)',
            text: '#e5edff',
            muted: '#9fb0d9',
            border: 'rgba(99, 102, 241, 0.34)',
            shadow: '0 30px 70px rgba(4, 8, 20, 0.65)',
            shadowSoft: '0 16px 36px rgba(4, 8, 20, 0.50)',
            glow: '0 0 0 1px rgba(56, 189, 248, 0.20) inset, 0 0 26px rgba(59, 130, 246, 0.28)',
          },
        },
        {
          id: 'industrial',
          name: '工业雾钢',
          preview: `url("${themeAssetBase}/04_industrial.png")`,
          lightBackground: `url("${themeAssetBase}/04_industrial.png")`,
          darkBackground: `linear-gradient(180deg, rgba(8, 12, 20, 0.40) 0%, rgba(8, 12, 20, 0.72) 100%), url("${themeAssetBase}/04_industrial.png")`,
          accent: '#64748b',
          accentSoft: 'rgba(100, 116, 139, 0.18)',
          brand: 'linear-gradient(135deg, #cbd5e1, #64748b)',
          light: {
            surface: 'rgba(248, 250, 252, 0.82)',
            surfaceStrong: 'rgba(255, 255, 255, 0.94)',
            text: '#0f172a',
            muted: '#5b677a',
            border: 'rgba(100, 116, 139, 0.22)',
            shadow: '0 26px 60px rgba(30, 41, 59, 0.16)',
            shadowSoft: '0 12px 30px rgba(30, 41, 59, 0.10)',
            glow: '0 0 0 1px rgba(148, 163, 184, 0.22) inset, 0 10px 30px rgba(0, 0, 0, 0.08)',
            tabBg: 'linear-gradient(180deg, rgba(255, 255, 255, 0.92), rgba(236, 240, 247, 0.9))',
            tabBorder: 'rgba(148, 163, 184, 0.24)',
            primaryBg: 'linear-gradient(180deg, #94a3b8, #64748b)',
            primaryShadow: '0 12px 26px rgba(100, 116, 139, 0.28)',
            homeCreateBg: 'linear-gradient(135deg, rgba(148, 163, 184, 0.92), rgba(100, 116, 139, 0.95))',
            homeProgressBg: 'linear-gradient(135deg, rgba(20, 184, 166, 0.9), rgba(14, 116, 144, 0.95))',
            homeCompletedBg: 'linear-gradient(135deg, rgba(249, 115, 22, 0.9), rgba(234, 88, 12, 0.95))',
          },
          dark: {
            surface: 'rgba(17, 22, 32, 0.84)',
            surfaceStrong: 'rgba(20, 26, 40, 0.94)',
            text: '#e7edf6',
            muted: '#a9b5c7',
            border: 'rgba(148, 163, 184, 0.24)',
            shadow: '0 30px 70px rgba(0, 0, 0, 0.62)',
            shadowSoft: '0 16px 36px rgba(0, 0, 0, 0.48)',
            glow: '0 0 0 1px rgba(148, 163, 184, 0.12) inset, 0 10px 30px rgba(0, 0, 0, 0.55)',
            tabBg: 'rgba(24, 30, 44, 0.95)',
            tabBorder: 'rgba(148, 163, 184, 0.28)',
            primaryBg: 'linear-gradient(180deg, #94a3b8, #475569)',
            primaryShadow: '0 14px 30px rgba(148, 163, 184, 0.18)',
            homeCreateBg: 'linear-gradient(135deg, rgba(148, 163, 184, 0.75), rgba(71, 85, 105, 0.95))',
            homeProgressBg: 'linear-gradient(135deg, rgba(16, 185, 129, 0.85), rgba(14, 116, 144, 0.95))',
            homeCompletedBg: 'linear-gradient(135deg, rgba(249, 115, 22, 0.9), rgba(194, 65, 12, 0.95))',
          },
        },
        {
          id: 'retro',
          name: '复古终端',
          preview: `url("${themeAssetBase}/05_retro_terminal.png")`,
          lightBackground: `linear-gradient(180deg, rgba(0, 0, 0, 0.10) 0%, rgba(0, 0, 0, 0.18) 100%), url("${themeAssetBase}/05_retro_terminal.png")`,
          darkBackground: `linear-gradient(180deg, rgba(0, 0, 0, 0.35) 0%, rgba(0, 0, 0, 0.75) 100%), url("${themeAssetBase}/05_retro_terminal.png")`,
          accent: '#22c55e',
          accentSoft: 'rgba(34, 197, 94, 0.18)',
          brand: 'linear-gradient(135deg, #86efac, #22c55e)',
          light: {
            surface: 'rgba(246, 255, 250, 0.80)',
            surfaceStrong: 'rgba(255, 255, 255, 0.94)',
            text: '#052e16',
            muted: '#1f6a3a',
            border: 'rgba(34, 197, 94, 0.22)',
            shadow: '0 26px 60px rgba(5, 46, 22, 0.14)',
            shadowSoft: '0 12px 30px rgba(5, 46, 22, 0.10)',
            glow: '0 0 0 1px rgba(34, 197, 94, 0.22) inset, 0 10px 30px rgba(34, 197, 94, 0.12)',
            tabBg: 'linear-gradient(180deg, rgba(255, 255, 255, 0.92), rgba(235, 247, 239, 0.9))',
            tabBorder: 'rgba(34, 197, 94, 0.18)',
            primaryBg: 'linear-gradient(180deg, #86efac, #22c55e)',
            primaryShadow: '0 12px 26px rgba(34, 197, 94, 0.28)',
            homeCreateBg: 'linear-gradient(135deg, rgba(134, 239, 172, 0.92), rgba(34, 197, 94, 0.92))',
            homeProgressBg: 'linear-gradient(135deg, rgba(20, 184, 166, 0.9), rgba(14, 116, 144, 0.95))',
            homeCompletedBg: 'linear-gradient(135deg, rgba(249, 115, 22, 0.9), rgba(234, 88, 12, 0.95))',
          },
          dark: {
            surface: 'rgba(9, 18, 12, 0.84)',
            surfaceStrong: 'rgba(11, 24, 16, 0.94)',
            text: '#d9ffe7',
            muted: '#9be3ba',
            border: 'rgba(34, 197, 94, 0.26)',
            shadow: '0 30px 70px rgba(0, 0, 0, 0.62)',
            shadowSoft: '0 16px 36px rgba(0, 0, 0, 0.48)',
            glow: '0 0 0 1px rgba(34, 197, 94, 0.16) inset, 0 0 26px rgba(34, 197, 94, 0.18)',
            tabBg: 'rgba(14, 26, 18, 0.95)',
            tabBorder: 'rgba(34, 197, 94, 0.26)',
            primaryBg: 'linear-gradient(180deg, #22c55e, #16a34a)',
            primaryShadow: '0 14px 30px rgba(34, 197, 94, 0.22)',
            homeCreateBg: 'linear-gradient(135deg, rgba(34, 197, 94, 0.78), rgba(22, 163, 74, 0.95))',
            homeProgressBg: 'linear-gradient(135deg, rgba(16, 185, 129, 0.85), rgba(14, 116, 144, 0.95))',
            homeCompletedBg: 'linear-gradient(135deg, rgba(249, 115, 22, 0.9), rgba(194, 65, 12, 0.95))',
          },
        },
        {
          id: 'mono',
          name: '极简黑白',
          preview: `url("${themeAssetBase}/06_minimal_mono.png")`,
          lightBackground: `url("${themeAssetBase}/06_minimal_mono.png")`,
          darkBackground: `linear-gradient(180deg, rgba(0, 0, 0, 0.30) 0%, rgba(0, 0, 0, 0.62) 100%), url("${themeAssetBase}/06_minimal_mono.png")`,
          accent: '#111827',
          accentSoft: 'rgba(17, 24, 39, 0.12)',
          brand: 'linear-gradient(135deg, #111827, #6b7280)',
          light: {
            surface: 'rgba(255, 255, 255, 0.78)',
            surfaceStrong: 'rgba(255, 255, 255, 0.94)',
            text: '#111827',
            muted: '#4b5563',
            border: 'rgba(17, 24, 39, 0.14)',
            shadow: '0 26px 60px rgba(17, 24, 39, 0.12)',
            shadowSoft: '0 12px 30px rgba(17, 24, 39, 0.08)',
            glow: '0 0 0 1px rgba(17, 24, 39, 0.10) inset, 0 10px 30px rgba(0, 0, 0, 0.06)',
            tabBg: 'linear-gradient(180deg, rgba(255, 255, 255, 0.92), rgba(245, 246, 248, 0.92))',
            tabBorder: 'rgba(17, 24, 39, 0.12)',
            primaryBg: 'linear-gradient(180deg, #111827, #374151)',
            primaryShadow: '0 12px 26px rgba(17, 24, 39, 0.22)',
            homeCreateBg: 'linear-gradient(135deg, rgba(17, 24, 39, 0.85), rgba(55, 65, 81, 0.95))',
            homeProgressBg: 'linear-gradient(135deg, rgba(20, 184, 166, 0.9), rgba(14, 116, 144, 0.95))',
            homeCompletedBg: 'linear-gradient(135deg, rgba(249, 115, 22, 0.9), rgba(234, 88, 12, 0.95))',
          },
          dark: {
            surface: 'rgba(13, 15, 20, 0.86)',
            surfaceStrong: 'rgba(16, 18, 24, 0.94)',
            text: '#f5f6f8',
            muted: '#c1c6d0',
            border: 'rgba(148, 163, 184, 0.22)',
            shadow: '0 30px 70px rgba(0, 0, 0, 0.62)',
            shadowSoft: '0 16px 36px rgba(0, 0, 0, 0.48)',
            glow: '0 0 0 1px rgba(255, 255, 255, 0.06) inset, 0 10px 30px rgba(0, 0, 0, 0.55)',
            tabBg: 'rgba(24, 30, 44, 0.95)',
            tabBorder: 'rgba(148, 163, 184, 0.24)',
            primaryBg: 'linear-gradient(180deg, #e5e7eb, #9ca3af)',
            primaryShadow: '0 14px 30px rgba(255, 255, 255, 0.08)',
            homeCreateBg: 'linear-gradient(135deg, rgba(255, 255, 255, 0.14), rgba(156, 163, 175, 0.20))',
            homeProgressBg: 'linear-gradient(135deg, rgba(16, 185, 129, 0.85), rgba(14, 116, 144, 0.95))',
            homeCompletedBg: 'linear-gradient(135deg, rgba(249, 115, 22, 0.9), rgba(194, 65, 12, 0.95))',
          },
        },
        {
          id: 'graphite',
          name: '石墨专业',
          preview: `url("${themeAssetBase}/07_graphite_pro.png")`,
          lightBackground: `url("${themeAssetBase}/07_graphite_pro.png")`,
          darkBackground: `linear-gradient(180deg, rgba(8, 12, 20, 0.35) 0%, rgba(8, 12, 20, 0.70) 100%), url("${themeAssetBase}/07_graphite_pro.png")`,
          accent: '#3b82f6',
          accentSoft: 'rgba(59, 130, 246, 0.16)',
          brand: 'linear-gradient(135deg, #93c5fd, #3b82f6)',
          light: {
            surface: 'rgba(244, 249, 255, 0.84)',
            surfaceStrong: 'rgba(255, 255, 255, 0.94)',
            text: '#0f172a',
            muted: '#53627d',
            border: 'rgba(59, 130, 246, 0.18)',
            shadow: '0 26px 60px rgba(30, 64, 175, 0.16)',
            shadowSoft: '0 12px 30px rgba(30, 64, 175, 0.10)',
            glow: '0 0 0 1px rgba(59, 130, 246, 0.18) inset, 0 10px 30px rgba(59, 130, 246, 0.10)',
            tabBg: 'linear-gradient(180deg, rgba(255, 255, 255, 0.92), rgba(235, 242, 252, 0.9))',
            tabBorder: 'rgba(59, 130, 246, 0.18)',
            primaryBg: 'linear-gradient(180deg, #93c5fd, #3b82f6)',
            primaryShadow: '0 12px 26px rgba(59, 130, 246, 0.30)',
            homeCreateBg: 'linear-gradient(135deg, rgba(147, 197, 253, 0.92), rgba(59, 130, 246, 0.92))',
            homeProgressBg: 'linear-gradient(135deg, rgba(20, 184, 166, 0.9), rgba(14, 116, 144, 0.95))',
            homeCompletedBg: 'linear-gradient(135deg, rgba(249, 115, 22, 0.9), rgba(234, 88, 12, 0.95))',
          },
          dark: {
            surface: 'rgba(10, 14, 24, 0.84)',
            surfaceStrong: 'rgba(16, 21, 38, 0.94)',
            text: '#e5edff',
            muted: '#9fb0d9',
            border: 'rgba(59, 130, 246, 0.28)',
            shadow: '0 30px 70px rgba(0, 0, 0, 0.62)',
            shadowSoft: '0 16px 36px rgba(0, 0, 0, 0.48)',
            glow: '0 0 0 1px rgba(59, 130, 246, 0.16) inset, 0 0 26px rgba(59, 130, 246, 0.18)',
            tabBg: 'rgba(24, 30, 44, 0.95)',
            tabBorder: 'rgba(59, 130, 246, 0.28)',
            primaryBg: 'linear-gradient(180deg, #3b82f6, #1d4ed8)',
            primaryShadow: '0 14px 30px rgba(59, 130, 246, 0.22)',
            homeCreateBg: 'linear-gradient(135deg, rgba(59, 130, 246, 0.78), rgba(29, 78, 216, 0.95))',
            homeProgressBg: 'linear-gradient(135deg, rgba(16, 185, 129, 0.85), rgba(14, 116, 144, 0.95))',
            homeCompletedBg: 'linear-gradient(135deg, rgba(249, 115, 22, 0.9), rgba(194, 65, 12, 0.95))',
          },
        },
        {
          id: 'starlight',
          name: '星光浅金',
          preview: `url("${themeAssetBase}/08_starlight.png")`,
          lightBackground: `url("${themeAssetBase}/08_starlight.png")`,
          darkBackground: `linear-gradient(180deg, rgba(8, 12, 20, 0.38) 0%, rgba(8, 12, 20, 0.72) 100%), url("${themeAssetBase}/08_starlight.png")`,
          accent: '#0a84ff',
          accentSoft: 'rgba(10, 132, 255, 0.16)',
          brand: 'linear-gradient(135deg, #d6c7a1, #0a84ff)',
          light: {
            surface: 'rgba(255, 252, 246, 0.84)',
            surfaceStrong: 'rgba(255, 255, 255, 0.94)',
            text: '#0f172a',
            muted: '#6b6476',
            border: 'rgba(214, 199, 161, 0.22)',
            shadow: '0 26px 60px rgba(30, 41, 59, 0.14)',
            shadowSoft: '0 12px 30px rgba(30, 41, 59, 0.10)',
            glow: '0 0 0 1px rgba(214, 199, 161, 0.22) inset, 0 10px 30px rgba(10, 132, 255, 0.10)',
            tabBg: 'linear-gradient(180deg, rgba(255, 255, 255, 0.92), rgba(246, 242, 234, 0.9))',
            tabBorder: 'rgba(214, 199, 161, 0.22)',
            primaryBg: 'linear-gradient(180deg, #d6c7a1, #0a84ff)',
            primaryShadow: '0 12px 26px rgba(10, 132, 255, 0.24)',
            homeCreateBg: 'linear-gradient(135deg, rgba(214, 199, 161, 0.92), rgba(10, 132, 255, 0.80))',
            homeProgressBg: 'linear-gradient(135deg, rgba(20, 184, 166, 0.9), rgba(14, 116, 144, 0.95))',
            homeCompletedBg: 'linear-gradient(135deg, rgba(249, 115, 22, 0.9), rgba(234, 88, 12, 0.95))',
          },
          dark: {
            surface: 'rgba(14, 18, 28, 0.84)',
            surfaceStrong: 'rgba(16, 21, 38, 0.94)',
            text: '#e5edff',
            muted: '#b9b1c8',
            border: 'rgba(214, 199, 161, 0.20)',
            shadow: '0 30px 70px rgba(0, 0, 0, 0.62)',
            shadowSoft: '0 16px 36px rgba(0, 0, 0, 0.48)',
            glow: '0 0 0 1px rgba(214, 199, 161, 0.12) inset, 0 0 26px rgba(10, 132, 255, 0.14)',
            tabBg: 'rgba(24, 30, 44, 0.95)',
            tabBorder: 'rgba(214, 199, 161, 0.18)',
            primaryBg: 'linear-gradient(180deg, #0a84ff, #2563eb)',
            primaryShadow: '0 14px 30px rgba(10, 132, 255, 0.20)',
            homeCreateBg: 'linear-gradient(135deg, rgba(214, 199, 161, 0.55), rgba(10, 132, 255, 0.78))',
            homeProgressBg: 'linear-gradient(135deg, rgba(16, 185, 129, 0.85), rgba(14, 116, 144, 0.95))',
            homeCompletedBg: 'linear-gradient(135deg, rgba(249, 115, 22, 0.9), rgba(194, 65, 12, 0.95))',
          },
        },
        {
          id: 'lavender',
          name: '薰衣草雾',
          preview: `url("${themeAssetBase}/09_lavender_mist.png")`,
          lightBackground: `url("${themeAssetBase}/09_lavender_mist.png")`,
          darkBackground: `linear-gradient(180deg, rgba(8, 12, 20, 0.35) 0%, rgba(8, 12, 20, 0.70) 100%), url("${themeAssetBase}/09_lavender_mist.png")`,
          accent: '#af52de',
          accentSoft: 'rgba(175, 82, 222, 0.16)',
          brand: 'linear-gradient(135deg, #c4b5fd, #af52de)',
          light: {
            surface: 'rgba(252, 249, 255, 0.84)',
            surfaceStrong: 'rgba(255, 255, 255, 0.94)',
            text: '#0f172a',
            muted: '#6a5d86',
            border: 'rgba(175, 82, 222, 0.18)',
            shadow: '0 26px 60px rgba(67, 56, 202, 0.14)',
            shadowSoft: '0 12px 30px rgba(67, 56, 202, 0.10)',
            glow: '0 0 0 1px rgba(175, 82, 222, 0.18) inset, 0 10px 30px rgba(175, 82, 222, 0.10)',
            tabBg: 'linear-gradient(180deg, rgba(255, 255, 255, 0.92), rgba(245, 241, 252, 0.9))',
            tabBorder: 'rgba(175, 82, 222, 0.18)',
            primaryBg: 'linear-gradient(180deg, #c4b5fd, #af52de)',
            primaryShadow: '0 12px 26px rgba(175, 82, 222, 0.26)',
            homeCreateBg: 'linear-gradient(135deg, rgba(196, 181, 253, 0.92), rgba(175, 82, 222, 0.86))',
            homeProgressBg: 'linear-gradient(135deg, rgba(20, 184, 166, 0.9), rgba(14, 116, 144, 0.95))',
            homeCompletedBg: 'linear-gradient(135deg, rgba(249, 115, 22, 0.9), rgba(234, 88, 12, 0.95))',
          },
          dark: {
            surface: 'rgba(14, 16, 28, 0.84)',
            surfaceStrong: 'rgba(16, 21, 38, 0.94)',
            text: '#e5edff',
            muted: '#c0b2df',
            border: 'rgba(196, 181, 253, 0.20)',
            shadow: '0 30px 70px rgba(0, 0, 0, 0.62)',
            shadowSoft: '0 16px 36px rgba(0, 0, 0, 0.48)',
            glow: '0 0 0 1px rgba(196, 181, 253, 0.14) inset, 0 0 26px rgba(175, 82, 222, 0.16)',
            tabBg: 'rgba(24, 30, 44, 0.95)',
            tabBorder: 'rgba(196, 181, 253, 0.22)',
            primaryBg: 'linear-gradient(180deg, #af52de, #7c3aed)',
            primaryShadow: '0 14px 30px rgba(175, 82, 222, 0.18)',
            homeCreateBg: 'linear-gradient(135deg, rgba(175, 82, 222, 0.70), rgba(124, 58, 237, 0.95))',
            homeProgressBg: 'linear-gradient(135deg, rgba(16, 185, 129, 0.85), rgba(14, 116, 144, 0.95))',
            homeCompletedBg: 'linear-gradient(135deg, rgba(249, 115, 22, 0.9), rgba(194, 65, 12, 0.95))',
          },
        },
        {
          id: 'neon-city',
          name: '霓虹城',
          preview: `url("${themeAssetBase}/10_neon_city.png")`,
          lightBackground: `linear-gradient(180deg, rgba(255, 255, 255, 0.10) 0%, rgba(255, 255, 255, 0.02) 100%), url("${themeAssetBase}/10_neon_city.png")`,
          darkBackground: `linear-gradient(180deg, rgba(0, 0, 0, 0.25) 0%, rgba(0, 0, 0, 0.68) 100%), url("${themeAssetBase}/10_neon_city.png")`,
          accent: '#38bdf8',
          accentSoft: 'rgba(56, 189, 248, 0.22)',
          brand: 'linear-gradient(135deg, #4f46e5, #38bdf8)',
          light: {
            surface: 'rgba(245, 248, 255, 0.86)',
            surfaceStrong: 'rgba(255, 255, 255, 0.94)',
            text: '#0f172a',
            muted: '#5b678a',
            border: 'rgba(79, 70, 229, 0.2)',
            shadow: '0 26px 60px rgba(56, 68, 130, 0.28)',
            shadowSoft: '0 12px 30px rgba(56, 68, 130, 0.2)',
            glow: '0 0 0 1px rgba(99, 102, 241, 0.25) inset, 0 10px 30px rgba(99, 102, 241, 0.2)',
          },
          dark: {
            surface: 'rgba(12, 16, 30, 0.78)',
            surfaceStrong: 'rgba(16, 21, 38, 0.92)',
            text: '#e5edff',
            muted: '#9fb0d9',
            border: 'rgba(99, 102, 241, 0.32)',
            shadow: '0 30px 70px rgba(4, 8, 20, 0.65)',
            shadowSoft: '0 16px 36px rgba(4, 8, 20, 0.5)',
            glow: '0 0 0 1px rgba(56, 189, 248, 0.22) inset, 0 0 26px rgba(59, 130, 246, 0.28)',
          },
        },
      ];
      let currentThemeIndex = 0;

      const showToast = (message, anchor) => {
        if (!emptyToast) {
          return;
        }
        emptyToast.textContent = message;
        const rect = anchor.getBoundingClientRect();
        emptyToast.style.left = `${rect.left + rect.width / 2}px`;
        emptyToast.style.top = `${rect.bottom + 12}px`;
        emptyToast.classList.add('show');
        emptyToast.setAttribute('aria-hidden', 'false');
        window.clearTimeout(toastTimer);
        toastTimer = window.setTimeout(() => {
          emptyToast.classList.remove('show');
          emptyToast.setAttribute('aria-hidden', 'true');
        }, 1600);
      };

      const closeNavPanels = () => {
        navTabs.forEach((btn) => btn.classList.remove('active'));
        navPanels.forEach((panel) => panel.classList.remove('open'));
      };

      const setHomeView = (isActive) => {
        document.body.classList.toggle('home-active', isActive);
      };

      const setSidebarTitle = (title) => {
        if (sidebarTitle) {
          sidebarTitle.textContent = title;
        }
      };

      const formatShortTime = (date) =>
        date.toLocaleString('zh-CN', {
          hour12: false,
          hour: '2-digit',
          minute: '2-digit',
        });

      const formatTime = (date) =>
        date.toLocaleString('zh-CN', {
          hour12: false,
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit',
        });

      const renderTaskLogs = () => {
        if (!taskLogList) {
          return;
        }
        taskLogList.querySelectorAll('.task-row:not(.task-header)').forEach((row) => row.remove());
        taskLogs.slice(0, maxRecentTasks).forEach((entry) => {
          const row = document.createElement('div');
          row.className = 'task-row';
          row.setAttribute('role', 'row');
          const statusClass = entry.status === 'fail' ? 'fail' : 'success';
          const progressClass = statusClass === 'fail' ? '' : 'success';
          row.innerHTML = `
            <span role="cell">${entry.name}</span>
            <span role="cell">${entry.startTime}</span>
            <span role="cell">
              <span class="progress">
                <span class="progress-bar">
                  <span class="progress-fill ${progressClass}" style="--progress:${entry.progress}%"></span>
                </span>
                <span class="progress-value">${entry.progress}%</span>
              </span>
            </span>
            <span role="cell">${entry.endTime}</span>
            <span role="cell" class="result ${statusClass}">${entry.result}</span>
          `;
          taskLogList.appendChild(row);
        });
      };

      const renderSystemLogs = () => {
        if (!systemLogList) {
          return;
        }
        systemLogList.querySelectorAll('.log-row:not(.log-header)').forEach((row) => row.remove());
        taskLogs.forEach((entry) => {
          const row = document.createElement('div');
          row.className = 'log-row';
          row.setAttribute('role', 'row');
          row.innerHTML = `
            <span role="cell">${entry.name}</span>
            <span role="cell">${entry.startTime}</span>
            <span role="cell">
              <span class="progress">
                <span class="progress-bar">
                  <span
                    class="progress-fill ${entry.status === 'success' ? 'success' : ''}"
                    style="--progress: ${entry.progress}%"
                  ></span>
                </span>
                <span class="progress-value">${entry.progress}%</span>
              </span>
            </span>
            <span role="cell">${entry.endTime}</span>
            <span role="cell" class="result ${entry.status === 'success' ? 'success' : 'fail'}">
              ${entry.result}
            </span>
          `;
          systemLogList.appendChild(row);
        });
      };

      const addLogEntry = (message) => {
        const now = new Date();
        const shortTime = formatShortTime(now);
        const entry = {
          name: message,
          startTime: shortTime,
          endTime: shortTime,
          progress: 100,
          result: '完成',
          status: 'success',
          logTime: formatTime(now),
        };
        taskLogs.unshift(entry);
        renderTaskLogs();
        renderSystemLogs();
      };

      const hasProjectsByStatus = (status) =>
        projects.some((project) => project.status === status);

      const activateProjectView = (status, targetProject = null) => {
        if (!hasProjectsByStatus(status)) {
          return false;
        }
        if (targetProject) {
          currentProject = targetProject;
        } else {
          currentProject = projects.find((project) => project.status === status) || currentProject;
        }
        setHomeView(false);
        showMenuGroup('project');
        const targetPanel = document.getElementById('topology-panel');
        panels.forEach((panel) => panel.classList.toggle('active', panel === targetPanel));
        const defaultItem = document.querySelector('[data-menu="project"] .menu-item');
        if (defaultItem) {
          defaultItem
            .closest('.menu')
            .querySelectorAll('.menu-item')
            .forEach((button) => button.classList.toggle('active', button === defaultItem));
        }
        setSidebarTitle(currentProject ? currentProject.name : '项目管理');
        renderProjectStatusList();
        return true;
      };

      const showMenuGroup = (menuKey) => {
        menuGroups.forEach((menu) => {
          menu.classList.toggle('is-hidden', menu.dataset.menu !== menuKey);
        });
      };

      const renderProjectSubmenus = () => {
        const renderSubmenu = (container, status) => {
          if (!container) {
            return;
          }
          container.innerHTML = '';
          const items = projects.filter((project) => project.status === status);
          if (!items.length) {
            const emptyItem = document.createElement('button');
            emptyItem.type = 'button';
            emptyItem.className = 'nav-subitem is-disabled';
            emptyItem.textContent = '暂无项目';
            container.appendChild(emptyItem);
            return;
          }
          items.forEach((project) => {
            const item = document.createElement('button');
            item.type = 'button';
            item.className = 'nav-subitem';
            item.textContent = project.name;
            item.dataset.project = project.name;
            item.dataset.status = status;
            container.appendChild(item);
          });
        };
        renderSubmenu(projectSubmenuInProgress, 'in-progress');
        renderSubmenu(projectSubmenuCompleted, 'completed');
      };

      const renderHomeSubmenus = () => {
        const renderSubmenu = (container, status) => {
          if (!container) {
            return;
          }
          container.innerHTML = '';
          const items = projects.filter((project) => project.status === status);
          if (!items.length) {
            const emptyItem = document.createElement('button');
            emptyItem.type = 'button';
            emptyItem.className = 'home-subitem is-disabled';
            emptyItem.textContent = '暂无项目';
            container.appendChild(emptyItem);
            return;
          }
          items.forEach((project) => {
            const item = document.createElement('button');
            item.type = 'button';
            item.className = 'home-subitem';
            item.textContent = project.name;
            item.dataset.project = project.name;
            item.dataset.status = status;
            container.appendChild(item);
          });
        };
        renderSubmenu(homeSubmenuInProgress, 'in-progress');
        renderSubmenu(homeSubmenuCompleted, 'completed');
      };

      const renderProjectStatusList = () => {
        if (!projectStatusList) {
          return;
        }
        projectStatusList.innerHTML = '';
        if (!projects.length) {
          const emptyState = document.createElement('div');
          emptyState.className = 'project-status-empty';
          emptyState.textContent = '暂无项目，可先新建项目。';
          projectStatusList.appendChild(emptyState);
          return;
        }
        if (!currentProject) {
          const emptyState = document.createElement('div');
          emptyState.className = 'project-status-empty';
          emptyState.textContent = '暂无当前项目，请先选择项目。';
          projectStatusList.appendChild(emptyState);
          return;
        }
        [currentProject].forEach((project) => {
          const row = document.createElement('div');
          row.className = 'project-status-item';
          row.innerHTML = `
            <div class="project-status-info">
              <span class="project-name">${project.name}</span>
              <span class="project-state ${
                project.status === 'completed' ? 'is-completed' : 'is-progress'
              }">${project.status === 'completed' ? '已完成' : '正在进行'}</span>
            </div>
            <div class="project-status-actions">
              <button type="button" class="ghost" data-action="toggle-complete" data-project="${
                project.name
              }">${project.status === 'completed' ? '取消已完成' : '标记已完成'}</button>
            </div>
          `;
          projectStatusList.appendChild(row);
        });
      };

      const applyTheme = (theme) => {
        const root = document.documentElement;
        const isDarkMode = document.body.classList.contains('theme-dark');
        const variant = isDarkMode ? theme.dark : theme.light;
        root.style.setProperty(
          '--page-bg',
          isDarkMode ? theme.darkBackground : theme.lightBackground,
        );
        root.style.setProperty('--accent', theme.accent);
        root.style.setProperty('--accent-soft', theme.accentSoft);
        root.style.setProperty('--brand-gradient', theme.brand);
        [
          ['--surface', variant?.surface],
          ['--surface-strong', variant?.surfaceStrong],
          ['--text', variant?.text],
          ['--muted', variant?.muted],
          ['--border', variant?.border],
          ['--shadow', variant?.shadow],
          ['--shadow-soft', variant?.shadowSoft],
          ['--glow', variant?.glow],
        ].forEach(([key, value]) => {
          if (value) {
            root.style.setProperty(key, value);
          } else {
            root.style.removeProperty(key);
          }
        });
        if (theme.id) {
          document.body.dataset.theme = theme.id;
        } else {
          delete document.body.dataset.theme;
        }
      };

      const updateThemePreviews = () => {
        const isDarkMode = document.body.classList.contains('theme-dark');
        document.querySelectorAll('.theme-card').forEach((card) => {
          const index = Number(card.dataset.index);
          const theme = themePresets[index];
          card.style.setProperty(
            '--theme-preview',
            theme.preview || (isDarkMode ? theme.darkBackground : theme.lightBackground),
          );
        });
      };

      const updateThemeSelection = () => {
        document.querySelectorAll('.theme-card').forEach((card) => {
          card.classList.toggle(
            'selected',
            Number(card.dataset.index) === currentThemeIndex,
          );
        });
      };

      const renderThemeCards = () => {
        if (!themeGrid) {
          return;
        }
        themeGrid.innerHTML = '';
        themePresets.forEach((theme, index) => {
          const card = document.createElement('button');
          card.type = 'button';
          card.className = 'theme-card';
          card.dataset.index = index;
          card.innerHTML = `<div class="theme-name">${theme.name}</div>`;
          themeGrid.appendChild(card);
        });
        updateThemePreviews();
        updateThemeSelection();
      };

      const randomTheme = () => {
        let nextIndex = currentThemeIndex;
        while (nextIndex === currentThemeIndex) {
          nextIndex = Math.floor(Math.random() * themePresets.length);
        }
        currentThemeIndex = nextIndex;
        applyTheme(themePresets[currentThemeIndex]);
      };

      applyTheme(themePresets[currentThemeIndex]);
      renderThemeCards();
      setHomeView(true);

      // ---- Theme/mode listeners block (keep only one copy, delete duplicates elsewhere) ----
      function syncModeChips(mode) {
        modeChips.forEach((chip) => {
          chip.classList.toggle('active', chip.dataset.mode === mode);
        });
      }
      function setMode(mode) {
        if (mode === 'dark') {
          document.body.classList.add('theme-dark');
        } else {
          document.body.classList.remove('theme-dark');
        }
        applyTheme(themePresets[currentThemeIndex]);
        updateThemePreviews();
        syncModeChips(mode);
      }
      modeChips.forEach((chip) => {
        chip.addEventListener('click', () => {
          setMode(chip.dataset.mode);
        });
      });
      themeGrid?.addEventListener('click', (e) => {
        const card = e.target.closest('.theme-card');
        if (!card) return;
        const index = Number(card.dataset.index);
        if (index === currentThemeIndex) return;
        currentThemeIndex = index;
        applyTheme(themePresets[currentThemeIndex]);
        updateThemePreviews();
        updateThemeSelection();
      });
      themeToggle?.addEventListener('click', () => {
        randomTheme();
        updateThemePreviews();
        updateThemeSelection();
      });
      modeToggle?.addEventListener('click', () => {
        const isDark = document.body.classList.contains('theme-dark');
        setMode(isDark ? 'light' : 'dark');
      });
      // ---- End theme/mode listeners block ----

      const updateModalState = () => {
        document.body.classList.toggle('modal-open', Boolean(document.querySelector('.modal.open')));
      };

      navTabs.forEach((tab) => {
        const navGroup = tab.closest('.nav-group');
        const openPanel = () => {
          window.clearTimeout(navCloseTimer);
          const targetId = tab.dataset.menu;
          navTabs.forEach((btn) => btn.classList.toggle('active', btn === tab));
          navPanels.forEach((panel) => panel.classList.toggle('open', panel.id === targetId));
        };

        const scheduleClose = () => {
          window.clearTimeout(navCloseTimer);
          navCloseTimer = window.setTimeout(() => {
            closeNavPanels();
          }, 260);
        };

        tab.addEventListener('click', (event) => {
          event.stopPropagation();
          openPanel();
        });

        navGroup.addEventListener('mouseenter', openPanel);
        navGroup.addEventListener('mouseleave', scheduleClose);
      });

      navPanels.forEach((panel) => {
        panel.addEventListener('mouseenter', () => {
          window.clearTimeout(navCloseTimer);
        });
        panel.addEventListener('mouseleave', () => {
          navCloseTimer = window.setTimeout(() => {
            closeNavPanels();
          }, 260);
        });
      });

      menuItems.forEach((item) => {
        item.addEventListener('click', () => {
          const target = item.dataset.panel;
          const parentMenu = item.closest('.menu');
          if (parentMenu) {
            parentMenu
              .querySelectorAll('.menu-item')
              .forEach((btn) => btn.classList.toggle('active', btn === item));
          }
          panels.forEach((panel) => {
            panel.classList.toggle('active', panel.id === target);
          });
          if (parentMenu?.dataset.menu === 'project') {
            setSidebarTitle(currentProject ? currentProject.name : '项目管理');
          } else if (parentMenu?.dataset.menu === 'system-basic') {
            setSidebarTitle('系统管理');
          } else if (parentMenu?.dataset.menu === 'system-log') {
            setSidebarTitle('系统管理');
          }
          setHomeView(false);
        });
      });

      taskButtons.forEach((button) => {
        button.addEventListener('click', () => {
          taskModal.classList.add('open');
          taskModal.setAttribute('aria-hidden', 'false');
          updateModalState();
          window.requestAnimationFrame(() => {
            taskModal.classList.add('visible');
            const rect = button.getBoundingClientRect();
            const modalCard = taskModal.querySelector('.modal-card');
            if (modalCard) {
              const modalHeight = modalCard.offsetHeight;
              const modalWidth = modalCard.offsetWidth;
              const left = Math.min(
                window.innerWidth - modalWidth - 24,
                rect.right + 16,
              );
              const top = Math.max(24, rect.bottom - modalHeight + 6);
              modalCard.style.left = `${left}px`;
              modalCard.style.top = `${top}px`;
            }
          });
        });
      });

      document.querySelectorAll('[data-close]').forEach((button) => {
        button.addEventListener('click', () => {
          const target = document.getElementById(button.dataset.close);
          target.classList.remove('open');
          target.classList.remove('visible');
          target.setAttribute('aria-hidden', 'true');
          updateModalState();
        });
      });

      versionButton.addEventListener('click', () => {
        versionModal.classList.add('open');
        versionModal.setAttribute('aria-hidden', 'false');
        updateModalState();
      });

      document.querySelectorAll('.nav-item').forEach((item) => {
        item.addEventListener('click', () => {
          const action = item.dataset.action;
          let shouldCloseNav = true;
          if (action === 'new-project') {
            projectModal.classList.add('open');
            projectModal.setAttribute('aria-hidden', 'false');
            updateModalState();
            projectInput.value = '';
            projectInput.focus();
          } else if (action === 'project-in-progress') {
            if (!hasProjectsByStatus('in-progress')) {
              showToast('暂无正在进行的项目', item);
            } else {
              showToast('请从列表选择项目', item);
            }
            shouldCloseNav = false;
          } else if (action === 'project-completed') {
            if (!hasProjectsByStatus('completed')) {
              showToast('暂无已完成的项目', item);
            } else {
              showToast('请从列表选择项目', item);
            }
            shouldCloseNav = false;
          } else if (action === 'system-basic') {
            setHomeView(false);
            showMenuGroup('system-basic');
            const targetPanel = document.getElementById('timeout-panel');
            panels.forEach((panel) => panel.classList.toggle('active', panel === targetPanel));
            const defaultItem = document.querySelector('[data-menu="system-basic"] .menu-item');
            if (defaultItem) {
              defaultItem
                .closest('.menu')
                .querySelectorAll('.menu-item')
                .forEach((button) => button.classList.toggle('active', button === defaultItem));
            }
            setSidebarTitle('系统管理');
          } else if (action === 'system-logs') {
            setHomeView(false);
            showMenuGroup('system-log');
            const targetPanel = document.getElementById('system-log-panel');
            panels.forEach((panel) => panel.classList.toggle('active', panel === targetPanel));
            const targetItem = document.querySelector(
              '[data-menu="system-log"] [data-panel="system-log-panel"]',
            );
            if (targetItem) {
              targetItem
                .closest('.menu')
                .querySelectorAll('.menu-item')
                .forEach((button) => button.classList.toggle('active', button === targetItem));
            }
            setSidebarTitle('系统管理');
          } else {
            showToast('无', item);
          }
          if (shouldCloseNav) {
            closeNavPanels();
          }
        });
      });

      projectSubmit.addEventListener('click', () => {
        const value = projectInput.value.trim();
        if (!value) {
          showToast('请输入项目名称', projectSubmit);
          projectInput.focus();
          return;
        }
        const project = { name: value, status: 'in-progress' };
        projects.unshift(project);
        currentProject = project;
        projectModal.classList.remove('open');
        projectModal.setAttribute('aria-hidden', 'true');
        updateModalState();
        addLogEntry(`创建项目：${value}`);
        activateProjectView('in-progress');
        renderProjectSubmenus();
        renderHomeSubmenus();
        renderProjectStatusList();
      });

      siteUploadButton.addEventListener('click', () => {
        siteModal.classList.add('open');
        siteModal.setAttribute('aria-hidden', 'false');
        updateModalState();
        siteFileInput.value = '';
        siteUploadSubmit.disabled = true;
      });

      siteFileInput.addEventListener('change', () => {
        siteUploadSubmit.disabled = !siteFileInput.files.length;
      });

      siteUploadSubmit.addEventListener('click', () =><truncated__content/>